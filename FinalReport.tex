\documentclass[10pt,a4paper]{article}

\usepackage{datetime}
\usepackage{numprint}
\usepackage{palatino}
\usepackage{authblk}
\usepackage[margin=0.75in]{geometry}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{titlesec}
\usepackage{listings}
\usepackage[english]{babel}
\usepackage[
	backend=biber,
	style=numeric-comp,
]{biblatex}
\addbibresource{refs.bib}

\setlength{\parindent}{2em}
%\setlength{\parskip}{1em}
\renewcommand{\baselinestretch}{1.0}

\begin{document}

\nplpadding{2}

\title{Penetration Testing Report}
\author{Naman Arora}
\date{\today}

\maketitle
\section{Executive Summary}

\section{Technical Report}
%===============Ex060
\subsection{Finding: vsftpd v2.3.4 Vulnerable to Backdoor Entry in \textit{`www.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 7.5}\\
		A malicious actor can gain backdoor access to the \textit{`www.f4rmc0rp.com'} server hosting the vsFTPd service.
	\item{Vulnerability Description}\\
		A set of crafted login credentials can lead to backdoor code activation planted by malicious actors in official release of vsFTPd v2.3.4.
		Such execution can lead to backdoor shell access on the server.
	\item{Confirmation Method}\\
		\textit{OpenVAS} scan confirms the existence of this vulnerability (Fig. \ref{openvas_vuls}).
		Exploit for the access is available in the \cite{vsftpd}.
	\item{Mitigation Strategy}\\
		Upgrade to the latest version of the software.
\end{itemize}

\subsection{Finding: vsftpd v2.3.4 FTP Unencrypted Cleartext Login in \textit{`www.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 4.8}\\
		\textit{`www.f4rmc0rp.com'} transports login credentials in cleartext.
	\item{Vulnerability Description}\\
		FTP Login credentials are sent in cleartext when loging in.
		A packer sniffer may harvest legitimate login credentials.
	\item{Confirmation Method}\\
		\textit{OpenVAS} scan confirms the vulnerability (Fig. \ref{openvas_vuls}.
		Packet capture using \textit{tcpdump} or \textit{wireshark} can also confirm this.
	\item{Mitigation Strategy}\\
		Enable secure FTP, \textit{FTPS} or enforce connection via \textit{`Auth TLS`} command.
\end{itemize}

\subsection{Finding: Anonymous FTP Login in \textit{`www.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 6.4}\\
		vsFTPd Server allows anonymous login.
	\item{Vulnerability Description}\\
		Anonymous login is possible to the FTP hosted on \textit{`www.f4rmc0rp.com'} and exfiltration of \textit{`hereisafile`} is possible.
	\item{Confirmation Method}\\
		\textit{OpenVAS} scan or \textit{nmap} aggressive scan confirms this vulnerability (Fig \ref{openvas_vuls}).
	\item{Mitigation Strategy}\\
		Disable Anonymous login in configuration files.
\end{itemize}

%\subsection{Finding: TCP Timestamps}
%\begin{itemize}
%        \item{Risk Rating: 2.6}\\
%        \item{Vulnerability Description}\\
%		It is possible to guess the uptime of the host \textit{`www.f4rmc0rp.com'}.
%        \item{Confirmation Method}\\
%		\textit{OpenVAS} scan or \textit{nmap} OS scan confirms this vulnerability (Fig. \ref{openvas_vulns}).
%        \item{Mitigation Strategy}\\
%                Disable TCP Timestamps.
%\end{itemize}

\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	%\centering
	\includegraphics[width=\columnwidth]{pics/openvas_vulns.png}
	\caption{OpenVAS Scan of \textit{`www.f4rmc0rp.com'}}
	\label{openvas_vulns}
\end{figure}

%=========Ex070
\subsection{Finding: Buffer Overflow in a service on \textit{`www.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 10.0}\\
		Buffer Overflow can lead to remote code execution.
	\item{Vulnerability Description}\\
		A service on the server \textit{`www.f4rmc0rp.com'} is vulnerable to \textit{Buffer Overflow} attack which may lead an attacker to remote shell access (Figure \ref{shell}).
	\item{Confirmation Method}\\
		The vulnerability can be exploited by passing 32 random characters in the username field followed by any command of choice to run on the target host.
	\item{Mitigation Strategy}\\
		The access to source code for the service was found during the exfiltration phase.
		An analysis of the code reveals a mistyped buffer length in the \textit{fgets call} on \textit{admin} buffer.
		The correct length is represented by the variable \textit{NAMELEN = 16 bytes} while \textit{BUFLEN = 1024 bytes} is used instead.
\end{itemize}

\subsection{Finding: Cleartext Login and Information Exchange in a service on \textit{`www.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 4.5}\\
		Cleartext passing of credentials may lead to credential harvesting.
	\item{Vulnerability Description}\\
		The service has no built in encryption and all the packets can be captured to harvest the username as well as information being transferred to a authorized user (Figure \ref{cleartext}).
	\item{Confirmation Method}\\
		A packet sniffer like \textit{Wireshark} or \textit{tcpdump} reveals the packet payloads to have no encryption.
	\item{Mitigation Strategy}\\
		This can be done by using APIs like \textit{libressl} or \textit{openssl} in the source code.
		Make sure secure functionalities like Encryption should \textbf{not} developed from scratch and secure and well established libraries should be used instead.
\end{itemize}

\subsection{Finding: Missing Password Authentication in a service on \textit{`www.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 4.0}\\
		Any unauthenticated user can use the service to audit processes.
	\item{Vulnerability Description}\\
		This service is not password protected and any attacker with a bit of social engineering can figure out that the username is \textit{brian}.
	\item{Confirmation Method}\\
		Having the username for the service, no password is required for login.
	\item{Mitigation Strategy}\\
		This can be done by either using third part libraries or coding the password field feature during authentication and maintaining a database of securely hashed passwords.
\end{itemize}

\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/shell.png}
	\caption{Remote Shell Access \textit{Buffer Overflow}}
	\label{shell}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/cleartext.png}
	\caption{Username in Cleartext \textit{(Packet Capture)}}
	\label{cleartext}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/passwd.png}
	\caption{No Password Authentication}
	\label{passwd}
\end{figure}

%==========Ex080
\subsection{Finding: Unchanged Default Username and Password Combination in Control Panel of \textit{`innerouter.f4rmc0rp.com}}
\begin{itemize}
	\item{Risk Rating: 10.0}\\
		The administrator panel at \textit{`innerouter.f4rmc0rp.com'} be exploited for firewall penetration by malicious actors.
	\item{Vulnerability Description}\\
		The hosted webservice is vulnerable since it has default credentials for the administrator account.
		The webservice, being the control panel for a routing software, may be used by a bad actor to gain access to internal network, by bypassing firewall.
	\item{Confirmation Method}\\
		The default credentials, \textit{`admin`:`pf***se`} can be used to gain access to admin panel.
	\item{Remediation}\\
		The webservice may be secured by adhering to the \cite{nist} guidelines.
\end{itemize}

\subsection{Finding: SSL/TLS Missing \textit{`Secure'} Cookie Attribute in Control Panel of \textit{`innerouter.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 6.4}
		The hosted webservice is vulnerable to \textit{`Session SideJacking`} attack which may give full access to remote and unauthenticated user.
	\item{Vulnerability Description}
		Since the session cookies are set and passed unencrypted, they can be captured by a bad actor while an authorized user is using the service.
		The cookie can then be passed by the bad actor to the service to gain authenticated remote access.
	\item{Confirmation Method}
		The OpenVAS scan (Fig. \ref{scan}) confirms the vulnerability.
	\item{Remediation}
		Enable \textit{`secure`} attribute for cookies.
\end{itemize}

\subsection{Finding: Missing \textit{`httpOnly`} Cookie Attribute in Control Panel of \textit{`innerouter.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 5.0}
		The webservice is vulnerable to \textit{Session SideJacking} attack by passing cookies via non-HTTP mediums.
	\item{Vulnerability Description}
		The webservice can be \textit{SideJacked} by a bad actor in possession of a valid session cookie of an authenticated user using non-HTTP mediums.
	\item{Confirmation Method}
		The OpenVAS scan (Fig. \ref{scan}) confirms the vulnerability.
	\item{Remediation}
		Enable \textit{`httpOnlu`} attribute for all session cookies.
\end{itemize}

\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/openvas.png}
	\caption{\textit{OpenVAS Scan} of \textit{`innerouter.f4rmc0rp.com'}}
	\label{scan}
\end{figure}

%==========Ex090
\subsection{Finding: Weak Service Permissions in \textit{`herd.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 10.0}\\
		Improper service permission may lead a local user either elevating privileges or adding users with higher privileges (\textit{`BITS`} service in this case).
	\item{Vulnerability Description}\\
		When regular users have start/stop permissions on services that run with LocalAdministrator privileges, the said user may run any arbitrary commands by changing the \textit{SERVICE\_BIN\_PATH}.
		This may lead to privilege escalation on the part of the user.
	\item{Confirmation Method}\\
		Microsoft provides a utility, \textit{AccessChk} \cite{accesschk} specifically for this purpose.
		\begin{lstlisting}[language=bash]
		>> accesschk users -cw *
		\end{lstlisting}
	\item{Remediation}\\
		Privilege escalation through weak service permissions can be remedied by not giving the normal users permission to start/stop Administrator/Local Administrator controlled services.
		Also, only the Administrator/Local Administrator should have access to directories where the service binaries are stored.
\end{itemize}

%=========Ex0d0
\subsection{Finding: Unauthenticated Access to \textit{NT Authority\textbackslash System} on \textit{`patronum.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 8.0}\\
		The access to \textit{NT Authority\textbackslash System} on \textit{`patronum.f4rmc0rp.com'} via \textit{Remote Desktop}.
	\item{Vulnerability Description}\\
		If an attacker can reach the \textit{`patronum.f4rmc0rp.com'} using the \textit{Remote Desktop}, they can leverage the \textit{Sticky Keys} (Tapping \textit{`Shift'} 5 times) to access the \textit{`sethc.exe'} which in this case is replaced by \textit{`cmd.exe'}.
		The Command prompt is run by the \textit{NT Authority\textbackslash System} and thus, the attacker can add a new local user with administrative privileges.
	\item{Confirmation Method}\\
		The Vulnerability can be confirmed by \textbf{pressing \textit{`Shift'} key 5 times in quick succession} while logging into \textit{`patronum.f4rmc0rp.com'} using the \textit{Remote Desktop} (Fig. \ref{cmd}).
	\item{Remediation}\\
		The vulnerability can be remedied by pointing the \textit{`sthe.exe'} to the correct binary and \textbf{NOT} \textit{`cmd.exe'} (Fig \ref{sethc})
\end{itemize}

\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/cmd.png}
	\caption{Command Prompt with \textit{NT Authority\textbackslash System}}
	\label{cmd}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/sethc.png}
	\caption{Renamed \textit{`sethc.exe'}, actually is \textit{`cmd.exe'}}
	\label{sethc}
\end{figure}

%=========Ex0f0
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/sudo.png}
	\caption{CVE-2019-14287}
	\label{sudo}
\end{figure}
\subsection{Finding: Potential Bypass of Runas User restrictions (CVE-2019-14287) \cite{sudoh} on \textit{`devbox.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 9.0}\\
		\textit{Sudo} before the version 1.8.28 allows privileged bypassed access to blocked programs.
	\item{Vulnerability Description}\\
		An attacker with access to \textit{Runas ALL}  sudoer account may abuse restricted privileged access to certain binary execution by crafting a special user ID (Fig \ref{sudo}).
	\item{Confirmation Method}\\
		A version print on \textit{sudo} reveals the version number.
	\item{Remediation}\\
		Update \textit{Sudo} to latest stable version.
\end{itemize}

\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/sudoers.png}
	\caption{Insecure permissions for \textit{`/etc/sudoers'}}
	\label{sudoers}
\end{figure}
\subsection{Finding: Insecure Permissions for \textit{`/etc/sudoers'} on \textit{`devbox.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 2.0}\\
		Non privileged user might view \textit{sudo} configurations.
	\item{Vulnerability Description}\\
		A user with restricted \textit{sudo} access may view and exploit permissions by looking at the \textit{sudoers} file.
	\item{Confirmation Method}\\
		It can be confirmed using long listing the file path (Fig \ref{sudoers}).
	\item{Remediation}\\
		The \textit{sudoers} file must always have -r------ or 400 permissions set.
\end{itemize}

\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/getfacl.png}
	\caption{Insecure ACL permissions for \textit{`/bin/ps'}}
	\label{getfacl}
\end{figure}
\subsection{Finding: Inappropriate ACL for \textit{`/bin/ps'} on \textit{`devbox.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 2.0}\\
		The user \textit{m.mason} has write access to \textit{`bin/ps'} granted by extra set of ACL permissions.
	\item{Vulnerability Description}\\
		An unprivileged user may write to/modify the binary owned by \textit{root}.
	\item{Confirmation Method}\\
		A long listing of the binary path and/or \textit{getfacl} on the binary path reveal the incorrectly set ACL permissions (Fig. \ref{getfacl}).
	\item{Remediation}\\
		Remove user \textit{m.mason's} write access to the binary \textit{`/bin/ps'}.
\end{itemize}

%==========Ex130
\subsection{Finding: Missing \textit{`ca-cert'} in TTLS Wireless Configuration on \textit{`f4rmc0rp-ddwrt-1'}}
\begin{itemize}
	\item{Risk Rating: 7.0}\\
		A malicious device may be successful is impersonating as \textit{`f4rmc0rp-ddwrt-1'}.
	\item{Vulnerability Description}\\
		A malicious device may pose as \textit{`f4rmc0rp-ddwrt-1'} and capture the \textit{Challenge} and \textit{Response} of a device trying to associate.
		The captured \textit{Challenge} and \textit{Response} pair may then be used to crack the user credentials for the access to internal wireless network.
	\item{Confirmation Method}\\
		A created rogue device broadcasting the same \textit{ESSID} on same channel as \textit{`f4rmc0rp-ddwrt-1'} without any certificates captures connection attempts.
	\item{Remediation}\\
		Use a trusted \textit{CA Certificate} in \textit{wpa\_configuration} to avoid devices impersonating \textit{`f4rmc0rp-ddwrt-1'}, refer sample configuration \cite{wpa_config}.
\end{itemize}

%==========Ex140
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/dbg.png}
	\caption{Debug Mode Enabled}
	\label{dbg}
\end{figure}
\subsection{Finding: Debug Symbols in Production Application \textit{`f4rmc0rp.apk'}}
\begin{itemize}
	\item{Risk Rating: 3.0}\\
		The \textit{.apk} released for the customer has been built in debug mode.
	\item{Vulnerability Description}\\
		A malicious actor might reverse engineer the code to find hidden vulnerabilities.
		A release mode removes the debug symbols which helps in obfuscating some vulnerabilities until they are fixed.
	\item{Confirmation Method}\\
		The application can be reversed to reveal the \textit{`BuildConfig.java'} file with \textit{Debug mode} (Fig \ref{dbg}).
	\item{Mitigation Strategy}
		The release application should always be build in an explicit release mode \cite{masvs_dbg}.
\end{itemize}

\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/creds.png}
	\caption{Credentials in \textit{`ItemListActivity.java'}}
	\label{creds}
\end{figure}
\subsection{Finding: Hardcoded Database Server Credentials in Production Application \textit{`f4rmc0rp.apk'}}
\begin{itemize}
	\item{Risk Rating: 10.0}\\
		The database server credentials were hard-coded in the application source.
	\item{Vulnerability Description}\\
		A hard-coded string of credentials to the database server along with the URL of the database resource will lead a malicious actor to gain unauthorized access to that resource.
	\item{Confirmation Method}\\
		The reversing of the \textit{.apk} reveals a file inside the \textit{sources} named \textit{`ItemListActivity.java'} which contains the credentials (Fig \ref{creds}).
	\item{Mitigation Strategy}\\
		The application must never have hard-coded, instead, access tokens and authentications should be used by the application to gain access to remote resources \cite{masvs_creds}.
\end{itemize}

%==========Ex150
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/likely_vuln.png}
	\caption{Metasploit auxiliary \textit{MS17-010} Scanner}
	\label{metasploit}
\end{figure}
\subsection{Finding: MS17-010 (Eternal Blue) in \textit{`bdc.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 10.0}\\
		The host \textit{bdc.f4rmc0rp.com} is vulnerable to \cite{ms17-010} vulnerability.
	\item{Vulnerability Description}\\
		\textit{EternalBlue} is a cyberattack exploit that was developed by NSA (National Security Agency) in 2017.
		It allows the malicious actors to allow remote execution of arbitrary commands and gain access to the remote host by sending uniquely crafted messages.
		This tool specifically exploits the Server Message Block version which is also known as SMBv1 protocol that is present in Microsoft's Windows Operating System.
		SMBv1 is a file sharing protocol that allows remote access of files on a server. 
		Due to its nature, if one machine that is connected to the internet is infected via EnternalBlue, the whole network could be compromised.
		This makes the network harder to recover as all the machines in the network had to be brought down to remediate. The Malware was patched in MS17-010 
	\item{Confirmation Method}\\
		The host is a \textit{Windows Server 2016 x64 System} and can be confirmed as vulnerable to \textit{MS17-010} by visiting the MS official advisory.
		Another confirmation can be \textit{Metasploit Auxillary Scanner} (Fig. \ref{metasploit}).
	\item{Remediation}\\
		The system can be patched to latest version provided by Microsoft.
\end{itemize}

\newpage
\printbibliography

\end{document}
