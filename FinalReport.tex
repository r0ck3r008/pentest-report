\documentclass[10pt,a4paper]{article}

\usepackage{datetime}
\usepackage{numprint}
\usepackage{palatino}
\usepackage{authblk}
\usepackage[margin=0.75in]{geometry}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{titlesec}
\usepackage{listings}
\usepackage[english]{babel}
\usepackage[
	backend=biber,
	style=numeric-comp,
]{biblatex}
\addbibresource{refs.bib}

\setlength{\parindent}{2em}
%\setlength{\parskip}{1em}
\renewcommand{\baselinestretch}{1.0}

\begin{document}

\nplpadding{2}

\title{Penetration Testing Report}
\author{Naman Arora}
\date{\today}

\maketitle
\tableofcontents
\newpage
\section{Executive Summary}
\subsection{Background}
\textit{Pr0b3 LLC.} was tasked with conducting a penetration testing and vulnerability assessment of \textit{F4rmc0rp} during the Fall of 2020.
The kind of assessment agreed upon beforehand usually involves checking if the cyber defenses of a company can be defeated to exfiltrate confidential data or cause operational harm.
None of the assessments conducted during the assessment posed any harm to operational or informational security of the client.
The methods employed for assessments rely heavily on the standard best practices prevalent in the industry at the moment of testing.

\subsection{Overall Posture}
The overall result of the assessment includes multiple serious vulnerabilities which have been discovered going back a number of years.
The vulnerabilities of the likes of \textit{Eternal Blue}, \textit{vsFTPd v2.}, \textit{Sudo Bypass Exploit} etc. are of much prevalence in the malicious cyber hacking communities and can cause serious harm to the company's infrastructure.
Some of the other vulnerabilities found have to do with misconfiguration of some particular software.
Such misconfiguration at times either can be used as primary attack vector or else can be used to aid a much bigger attack.

Having said that, none of the assessments indicate an immediate presence of bad actors anywhere within the infrastructure.
Also as a silver lining, all of the discovered vulnerabilities require minimal effort for fixing.
None of the vulnerabilities require monetary investment, but just some investment on the part of the technical staff's time and a little bit of attention for the future.

\subsection{Risk Ranking/Profile}
The vulnerabilities found range from critical ($\ge 9$), intermediate ($[6, 9)$) and low ($\le 5$) (Fig \ref{vuln_dist}).
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/vuln_dist.png}
	\label{vuln_dist}
\end{figure}
The critical vulnerabilities have been known in the industry for quite some time and thus pose the greatest threat.
The rest of the vulnerabilities are the result of some misconfiguration either during deployment, or during in house production of such software.
It is safe to say that the risk profile of \textit{F4rmc0rp}, as it stands, is \textit{critical}.

\subsection{General Findings}
The assessment began with reconnaissance and exploration of domains within the \textit{F4rmc0rp}.
This resulted in multiple exposed domains from the initial DNS scan.
Some of the services running on the public facing server were vulnerable and resulted in shell access to the \textit{`www.f4rmc0rp.com'} server.
The assessment then moved on to exploiting a mis-configured router which acted as the doorway to the internal network.
The \textit{Windows} machines inside of the \textit{F4rmc0rp}, \textit{`patronum.f4rmc0rp.com'} and \textit{`herd.f4rmc0rp.com'} network were then exploited due to mis-configurations.
Both the machines eventually yielded \textit{LocalAdmin} access.
\textit{devbox.f4rmc0rp.com}, the\textit{Linux} machine, internal to the network also succumbed to the exploitation due to unpatched and vulnerable software.
The \textit{Domain Controller} \textit{`pdc.f4rmc0rp.com'}, was also breached due to its temporary backup, \textit{`bdc.f4rmc0rp.com'} being vulnerable to a \textit{EternalBlue}.
Towards the end, the newly installed internal wireless access point, \textit{`f4rmc0rp-ddwrt-1'} was also breached due to mis-configuration and access to internally hosted web-server was gained.

\subsection{Recommendation Summary}
\textit{Pr0b3 LLC.} would recommend that at least the critical vulnerabilities be fixed \textit{ASAP}, mis-configurations corrected and outdated software patched.
One of the Staff, \textit{Phineas}, was social engineered to give out company secrets via a web based attack.
Thus, we also would recommend that staff training must be introduced in general security concepts.
Most of the breaches in security are due to human vulnerabilities.
Moreover, the assessment is never complete.
Another recommendation would be to repeat such an assessment every year since the \textit{IT} industry is moving too quickly and so are the vulnerable services.

\subsection{Strategic Roadmap}
For about the next year, if the mentioned steps are taken, the company infrastructure would work very well.
All of the choices in software are latest and engineers have done a nice job in building up the infrastructure.
Since the security field is moving too quickly, new security focused recruits to the company would be a welcome addition or else outsourcing the security is also an option.

\newpage

\section{Technical Report}
%==========10.0
\subsection{Finding: Buffer Overflow in a service on \textit{`www.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 10.0}\\
		Buffer Overflow can lead to remote code execution.
	\item{Vulnerability Description}\\
		A service on the server \textit{`www.f4rmc0rp.com'} is vulnerable to \textit{Buffer Overflow} attack which may lead an attacker to remote shell access (Figure \ref{shell}).
	\item{Confirmation Method}\\
		The vulnerability can be exploited by passing 32 random characters in the username field followed by any command of choice to run on the target host.
	\item{Mitigation Strategy}\\
		The access to source code for the service was found during the exfiltration phase.
		An analysis of the code reveals a mistyped buffer length in the \textit{fgets call} on \textit{admin} buffer.
		The correct length is represented by the variable \textit{NAMELEN = 16 bytes} while \textit{BUFLEN = 1024 bytes} is used instead.
\end{itemize}

\subsection{Finding: Unchanged Default Username and Password Combination in Control Panel of \textit{`innerouter.f4rmc0rp.com}}
\begin{itemize}
	\item{Risk Rating: 10.0}\\
		The administrator panel at \textit{`innerouter.f4rmc0rp.com'} be exploited for firewall penetration by malicious actors.
	\item{Vulnerability Description}\\
		The hosted webservice is vulnerable since it has default credentials for the administrator account.
		The webservice, being the control panel for a routing software, may be used by a bad actor to gain access to internal network, by bypassing firewall.
	\item{Confirmation Method}\\
		The default credentials, \textit{`admin`:`pf***se`} can be used to gain access to admin panel.
	\item{Remediation}\\
		The webservice may be secured by adhering to the \cite{nist} guidelines.
\end{itemize}

\subsection{Finding: Weak Service Permissions in \textit{`herd.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 10.0}\\
		Improper service permission may lead a local user either elevating privileges or adding users with higher privileges (\textit{`BITS`} service in this case).
	\item{Vulnerability Description}\\
		When regular users have start/stop permissions on services that run with LocalAdministrator privileges, the said user may run any arbitrary commands by changing the \textit{SERVICE\_BIN\_PATH}.
		This may lead to privilege escalation on the part of the user.
	\item{Confirmation Method}\\
		Microsoft provides a utility, \textit{AccessChk} \cite{accesschk} specifically for this purpose.
		\begin{lstlisting}[language=bash]
		>> accesschk users -cw *
		\end{lstlisting}
	\item{Remediation}\\
		Privilege escalation through weak service permissions can be remedied by not giving the normal users permission to start/stop Administrator/Local Administrator controlled services.
		Also, only the Administrator/Local Administrator should have access to directories where the service binaries are stored.
\end{itemize}

\subsection{Finding: MS17-010 (Eternal Blue) in \textit{`bdc.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 10.0}\\
		The host \textit{bdc.f4rmc0rp.com} is vulnerable to \cite{ms17-010} vulnerability.
	\item{Vulnerability Description}\\
		\textit{EternalBlue} is a cyberattack exploit that was developed by NSA (National Security Agency) in 2017.
		It allows the malicious actors to allow remote execution of arbitrary commands and gain access to the remote host by sending uniquely crafted messages.
		This tool specifically exploits the Server Message Block version which is also known as SMBv1 protocol that is present in Microsoft's Windows Operating System.
		SMBv1 is a file sharing protocol that allows remote access of files on a server. 
		Due to its nature, if one machine that is connected to the internet is infected via EnternalBlue, the whole network could be compromised.
		This makes the network harder to recover as all the machines in the network had to be brought down to remediate. The Malware was patched in MS17-010 
	\item{Confirmation Method}\\
		The host is a \textit{Windows Server 2016 x64 System} and can be confirmed as vulnerable to \textit{MS17-010} by visiting the MS official advisory.
		Another confirmation can be \textit{Metasploit Auxillary Scanner} (Fig. \ref{metasploit}).
	\item{Remediation}\\
		The system can be patched to latest version provided by Microsoft.
\end{itemize}

\subsection{Finding: Hardcoded Database Server Credentials in Production Application \textit{`f4rmc0rp.apk'}}
\begin{itemize}
	\item{Risk Rating: 10.0}\\
		The database server credentials were hard-coded in the application source.
	\item{Vulnerability Description}\\
		A hard-coded string of credentials to the database server along with the URL of the database resource will lead a malicious actor to gain unauthorized access to that resource.
	\item{Confirmation Method}\\
		The reversing of the \textit{.apk} reveals a file inside the \textit{sources} named \textit{`ItemListActivity.java'} which contains the credentials (Fig \ref{creds}).
	\item{Mitigation Strategy}\\
		The application must never have hard-coded, instead, access tokens and authentications should be used by the application to gain access to remote resources \cite{masvs_creds}.
\end{itemize}

%==========9.0
\subsection{Finding: Potential Bypass of Runas User restrictions (CVE-2019-14287) on \textit{`devbox.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 9.0}\\
		\textit{Sudo} before the version 1.8.28 allows privileged bypassed access to blocked programs.
	\item{Vulnerability Description}\\
		An attacker with access to \textit{Runas ALL}  sudoer account may abuse restricted privileged access to certain binary execution by crafting a special user ID (Fig \ref{sudo}).
	\item{Confirmation Method}\\
		A version print on \textit{sudo} reveals the version number.
	\item{Remediation}\\
		Update \textit{Sudo} to latest stable version \cite{sudoh}.
\end{itemize}

%==========8.0
\subsection{Finding: Unauthenticated Access to \textit{NT Authority\textbackslash System} on \textit{`patronum.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 8.0}\\
		The access to \textit{NT Authority\textbackslash System} on \textit{`patronum.f4rmc0rp.com'} via \textit{Remote Desktop}.
	\item{Vulnerability Description}\\
		If an attacker can reach the \textit{`patronum.f4rmc0rp.com'} using the \textit{Remote Desktop}, they can leverage the \textit{Sticky Keys} (Tapping \textit{`Shift'} 5 times) to access the \textit{`sethc.exe'} which in this case is replaced by \textit{`cmd.exe'}.
		The Command prompt is run by the \textit{NT Authority\textbackslash System} and thus, the attacker can add a new local user with administrative privileges.
	\item{Confirmation Method}\\
		The Vulnerability can be confirmed by \textbf{pressing \textit{`Shift'} key 5 times in quick succession} while logging into \textit{`patronum.f4rmc0rp.com'} using the \textit{Remote Desktop} (Fig. \ref{cmd}).
	\item{Remediation}\\
		The vulnerability can be remedied by pointing the \textit{`sthe.exe'} to the correct binary and \textbf{NOT} \textit{`cmd.exe'} (Fig \ref{sethc})
\end{itemize}

%==========7.0
\subsection{Finding: vsftpd v2.3.4 Vulnerable to Backdoor Entry in \textit{`www.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 7.5}\\
		A malicious actor can gain backdoor access to the \textit{`www.f4rmc0rp.com'} server hosting the vsFTPd service.
	\item{Vulnerability Description}\\
		A set of crafted login credentials can lead to backdoor code activation planted by malicious actors in official release of vsFTPd v2.3.4.
		Such execution can lead to backdoor shell access on the server.
	\item{Confirmation Method}\\
		\textit{OpenVAS} scan confirms the existence of this vulnerability (Fig. \ref{openvas_vuls}).
		Exploit for the access is available in the \cite{vsftpd}.
	\item{Mitigation Strategy}\\
		Upgrade to the latest version of the software.
\end{itemize}

\subsection{Finding: Missing \textit{`ca-cert'} in TTLS Wireless Configuration on \textit{`f4rmc0rp-ddwrt-1'}}
\begin{itemize}
	\item{Risk Rating: 7.0}\\
		A malicious device may be successful is impersonating as \textit{`f4rmc0rp-ddwrt-1'}.
	\item{Vulnerability Description}\\
		A malicious device may pose as \textit{`f4rmc0rp-ddwrt-1'} and capture the \textit{Challenge} and \textit{Response} of a device trying to associate.
		The captured \textit{Challenge} and \textit{Response} pair may then be used to crack the user credentials for the access to internal wireless network.
	\item{Confirmation Method}\\
		A created rogue device broadcasting the same \textit{ESSID} on same channel as \textit{`f4rmc0rp-ddwrt-1'} without any certificates captures connection attempts.
	\item{Remediation}\\
		Use a trusted \textit{CA Certificate} in \textit{wpa\_configuration} to avoid devices impersonating \textit{`f4rmc0rp-ddwrt-1'}, refer sample configuration \cite{wpa_config}.
\end{itemize}

%==========6.0
\subsection{Finding: SSL/TLS Missing \textit{`Secure'} Cookie Attribute in Control Panel of \textit{`innerouter.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 6.4}\\
		The hosted webservice is vulnerable to \textit{`Session SideJacking'} attack which may give full access to remote and unauthenticated user.
	\item{Vulnerability Description}\\
		Since the session cookies are set and passed unencrypted, they can be captured by a bad actor while an authorized user is using the service.
		The cookie can then be passed by the bad actor to the service to gain authenticated remote access.
	\item{Confirmation Method}\\
		The OpenVAS scan (Fig. \ref{scan}) confirms the vulnerability.
	\item{Remediation}\\
		Enable \textit{`secure'} attribute for cookies.
\end{itemize}

\subsection{Finding: Anonymous FTP Login in \textit{`www.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 6.4}\\
		vsFTPd Server allows anonymous login.
	\item{Vulnerability Description}\\
		Anonymous login is possible to the FTP hosted on \textit{`www.f4rmc0rp.com'} and exfiltration of \textit{`hereisafile`} is possible.
	\item{Confirmation Method}\\
		\textit{OpenVAS} scan or \textit{nmap} aggressive scan confirms this vulnerability (Fig \ref{openvas_vuls}).
	\item{Mitigation Strategy}\\
		Disable Anonymous login in configuration files.
\end{itemize}

%==========5.0
\subsection{Finding: Missing \textit{`httpOnly`} Cookie Attribute in Control Panel of \textit{`innerouter.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 5.0}\\
		The webservice is vulnerable to \textit{Session SideJacking} attack by passing cookies via non-HTTP mediums.
	\item{Vulnerability Description}\\
		The webservice can be \textit{SideJacked} by a bad actor in possession of a valid session cookie of an authenticated user using non-HTTP mediums.
	\item{Confirmation Method}\\
		The OpenVAS scan (Fig. \ref{scan}) confirms the vulnerability.
	\item{Remediation}\\
		Enable \textit{`httpOnlu`} attribute for all session cookies.
\end{itemize}

%==========4.0
\subsection{Finding: vsftpd v2.3.4 FTP Unencrypted Cleartext Login in \textit{`www.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 4.8}\\
		\textit{`www.f4rmc0rp.com'} transports login credentials in cleartext.
	\item{Vulnerability Description}\\
		FTP Login credentials are sent in cleartext when loging in.
		A packer sniffer may harvest legitimate login credentials.
	\item{Confirmation Method}\\
		\textit{OpenVAS} scan confirms the vulnerability (Fig. \ref{openvas_vuls}.
		Packet capture using \textit{tcpdump} or \textit{wireshark} can also confirm this.
	\item{Mitigation Strategy}\\
		Enable secure FTP, \textit{FTPS} or enforce connection via \textit{`Auth TLS`} command.
\end{itemize}

\subsection{Finding: Cleartext Login and Information Exchange in a service on \textit{`www.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 4.5}\\
		Cleartext passing of credentials may lead to credential harvesting.
	\item{Vulnerability Description}\\
		The service has no built in encryption and all the packets can be captured to harvest the username as well as information being transferred to a authorized user (Figure \ref{cleartext}).
	\item{Confirmation Method}\\
		A packet sniffer like \textit{Wireshark} or \textit{tcpdump} reveals the packet payloads to have no encryption.
	\item{Mitigation Strategy}\\
		This can be done by using APIs like \textit{libressl} or \textit{openssl} in the source code.
		Make sure secure functionalities like Encryption should \textbf{not} developed from scratch and secure and well established libraries should be used instead.
\end{itemize}

\subsection{Finding: Missing Password Authentication in a service on \textit{`www.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 4.0}\\
		Any unauthenticated user can use the service to audit processes.
	\item{Vulnerability Description}\\
		This service is not password protected and any attacker with a bit of social engineering can figure out that the username is \textit{brian}.
	\item{Confirmation Method}\\
		Having the username for the service, no password is required for login.
	\item{Mitigation Strategy}\\
		This can be done by either using third part libraries or coding the password field feature during authentication and maintaining a database of securely hashed passwords.
\end{itemize}

%==========3.0
\subsection{Finding: Debug Symbols in Production Application \textit{`f4rmc0rp.apk'}}
\begin{itemize}
	\item{Risk Rating: 3.0}\\
		The \textit{.apk} released for the customer has been built in debug mode.
	\item{Vulnerability Description}\\
		A malicious actor might reverse engineer the code to find hidden vulnerabilities.
		A release mode removes the debug symbols which helps in obfuscating some vulnerabilities until they are fixed.
	\item{Confirmation Method}\\
		The application can be reversed to reveal the \textit{`BuildConfig.java'} file with \textit{Debug mode} (Fig \ref{dbg}).
	\item{Mitigation Strategy}
		The release application should always be build in an explicit release mode \cite{masvs_dbg}.
\end{itemize}

%==========2.0
\subsection{Finding: Insecure Permissions for \textit{`/etc/sudoers'} on \textit{`devbox.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 2.0}\\
		Non privileged user might view \textit{sudo} configurations.
	\item{Vulnerability Description}\\
		A user with restricted \textit{sudo} access may view and exploit permissions by looking at the \textit{sudoers} file.
	\item{Confirmation Method}\\
		It can be confirmed using long listing the file path (Fig \ref{sudoers}).
	\item{Remediation}\\
		The \textit{sudoers} file must always have -r------ or 400 permissions set.
\end{itemize}

\subsection{Finding: Inappropriate ACL for \textit{`/bin/ps'} on \textit{`devbox.f4rmc0rp.com'}}
\begin{itemize}
	\item{Risk Rating: 2.0}\\
		The user \textit{m.mason} has write access to \textit{`bin/ps'} granted by extra set of ACL permissions.
	\item{Vulnerability Description}\\
		An unprivileged user may write to/modify the binary owned by \textit{root}.
	\item{Confirmation Method}\\
		A long listing of the binary path and/or \textit{getfacl} on the binary path reveal the incorrectly set ACL permissions (Fig. \ref{getfacl}).
	\item{Remediation}\\
		Remove user \textit{m.mason's} write access to the binary \textit{`/bin/ps'}.
\end{itemize}

\newpage
%==========Images
\section{Appendix: Screenshots}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/shell.png}
	\caption{Remote Shell Access \textit{Buffer Overflow}}
	\label{shell}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/likely_vuln.png}
	\caption{Metasploit auxiliary \textit{MS17-010} Scanner}
	\label{metasploit}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/creds.png}
	\caption{Credentials in \textit{`ItemListActivity.java'}}
	\label{creds}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/sudo.png}
	\caption{CVE-2019-14287}
	\label{sudo}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/cmd.png}
	\caption{Command Prompt with \textit{NT Authority\textbackslash System}}
	\label{cmd}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/sethc.png}
	\caption{Renamed \textit{`sethc.exe'}, actually is \textit{`cmd.exe'}}
	\label{sethc}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/openvas_vulns.png}
	\caption{OpenVAS Scan of \textit{`www.f4rmc0rp.com'}}
	\label{openvas_vulns}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/openvas.png}
	\caption{\textit{OpenVAS Scan} of \textit{`innerouter.f4rmc0rp.com'}}
	\label{scan}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/cleartext.png}
	\caption{Username in Cleartext \textit{(Packet Capture)}}
	\label{cleartext}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/dbg.png}
	\caption{Debug Mode Enabled}
	\label{dbg}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/sudoers.png}
	\caption{Insecure permissions for \textit{`/etc/sudoers'}}
	\label{sudoers}
\end{figure}
\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
	\centering
	\includegraphics[width=\columnwidth]{pics/getfacl.png}
	\caption{Insecure ACL permissions for \textit{`/bin/ps'}}
	\label{getfacl}
\end{figure}
%\begin{figure}[!htbp]% [!hb] forces image to be placed at that position
%	\centering
%	\includegraphics[width=\columnwidth]{pics/passwd.png}
%	\caption{No Password Authentication}
%	\label{passwd}
%\end{figure}

\newpage
\printbibliography

\end{document}
